# 📘 자동매매 봇 프로젝트 구조 및 유지보수 가이드

이 문서는 Python 프로그래밍에 익숙하지 않은 운영자나 유지보수 담당자가 프로젝트의 전체 구조를 이해하고, 
안정적으로 봇을 운영/관리할 수 있도록 작성되었습니다.

---

## 1. 프로젝트 개요

이 프로그램은 한국 주식(신한/키움/대신)과 암호화폐(업비트/바이낸스)를 자동으로 사고파는 봇입니다.
사용자가 설정한 전략(머신러닝 예측 또는 기술적 지표)에 따라 24시간 시장을 감시하고 매매를 수행합니다.

---

## 2. 폴더 및 파일 구조 설명

프로젝트 폴더를 열었을 때 보이는 주요 폴더와 파일들의 역할입니다.

### 📂 주요 폴더

| 폴더명 | 설명 | 중요도 |
| :--- | :--- | :--- |
| **`config/`** | 봇의 동작 방식(전략, 매수 금액 등)을 설정하는 파일들이 있습니다. | ⭐⭐⭐ |
| **`data/`** | **[매우 중요]** 봇의 장부입니다. 현재 보유 종목, 평단가, 매매 기록이 저장됩니다. | ⭐⭐⭐ |
| **`api/`** | 증권사나 거래소 서버와 통신하는 코드들이 모여 있습니다. | ⭐ |
| **`trading/`** | 언제 사고팔지 결정하는 '두뇌' 역할(전략)과 자산 관리 코드가 있습니다. | ⭐⭐ |
| **`models/`** | AI가 학습한 결과 파일이 저장되는 곳입니다. 지워도 다시 학습하지만 시간이 걸립니다. | ⭐ |
| **`logs/`** | 봇이 작동하면서 남긴 기록(로그) 파일이 저장됩니다. 오류 발생 시 확인합니다. | ⭐⭐ |

### 📄 핵심 파일

| 파일명 | 설명 |
| :--- | :--- |
| **`main.py`** | **봇 실행 파일**입니다. 이 파일을 실행하면 봇이 켜집니다. |
| **`.env`** | **비밀번호 파일**입니다. API 키(ID/PW 역할)와 민감한 설정이 들어있습니다. |
| **`config/settings.py`** | **설정 파일**입니다. 매수 금액, 익절/손절 비율, 전략 등을 여기서 수정합니다. |
| **`build.py`** | 설치 및 배포를 도와주는 도구입니다. 처음 환경을 잡을 때 사용합니다. |

---

## 3. 봇의 작동 원리 (흐름)

봇은 켜져 있는 동안 아래 과정을 무한히 반복합니다.

1.  **초기화 (Start)**: `.env`에서 API 키를 읽어 거래소에 로그인하고, `data/` 폴더에서 장부를 불러옵니다.
2.  **학습 (Train)**: 과거 데이터를 읽어 AI 모델을 학습시킵니다. (하루 1회 또는 시작 시)
3.  **감시 (Monitor)**:
    *   현재 가격을 실시간으로 조회합니다.
    *   설정된 전략(예: RSI, 볼린저밴드)에 맞는지 계산합니다.
4.  **판단 (Decision)**:
    *   **매수**: 살 타이밍이고 돈이 있으면 매수 주문을 넣습니다.
    *   **매도**: 가지고 있는 종목이 목표 수익률에 도달하거나 손절가에 닿으면 팝니다.
5.  **기록 (Log)**: 모든 행동을 `logs/` 폴더와 텔레그램으로 보고합니다.

---

## 4. 유지보수 및 관리 방법

### ⚙️ 설정을 바꾸고 싶을 때

1.  **API 키 변경**: `.env` 파일을 메모장으로 열어 수정하세요.
2.  **매매 금액/전략 변경**: `config/settings.py` 파일을 엽니다.
    *   `TRADING_CONFIG` 부분을 찾아 `initial_capital`(투자금), `take_profit_percent`(익절률) 등을 수정합니다.
    *   수정 후 봇을 껐다 켜야 적용됩니다. (일부 설정은 `.env` 수정 시 자동 반영됨)

### 💾 백업 (가장 중요)

*   **무엇을?**: `data/` 폴더 전체와 `.env` 파일.
*   **언제?**: 봇을 끄거나 업데이트하기 전, 혹은 주기적으로(주 1회).
*   **왜?**: 컴퓨터가 고장 나거나 실수로 파일을 지웠을 때, 이 파일들만 있으면 복구할 수 있습니다.

### 🚨 오류 발생 시 대처

1.  **로그 확인**: `logs/` 폴더에 들어가서 가장 최근 날짜의 파일을 엽니다. `ERROR`라고 적힌 줄을 찾으세요.
2.  **API 오류**: "Unauthorized"나 "Key" 관련 에러라면 `.env` 파일의 API 키가 만료되었거나 틀린 것입니다.
3.  **재시작**: 대부분의 일시적인 오류는 봇을 껐다 켜면 해결됩니다.

---

## 5. 자주 묻는 질문 (FAQ)

### Q. 봇을 켰는데 매수를 안 해요!
봇이 매수를 하지 않는 데는 여러 가지 이유가 있습니다. 로그(`logs/` 폴더)를 확인해보세요.

1.  **웜업(Warm-up) 중**: 봇이 켜진 직후에는 데이터를 수집하고 지표를 계산하기 위해 약 3~5회 정도 매매를 건너뜁니다. 로그에 `[WARMUP]` 메시지가 뜬다면 정상입니다.
2.  **매수 조건 미달**: 현재 시장 상황이 설정된 전략(RSI, 볼린저밴드 등)에 맞지 않으면 매수하지 않습니다. 로그에 `HOLD` 또는 `진입 보류` 메시지가 있는지 확인하세요.
3.  **자금 부족**: 계좌에 '주문 가능 금액(예수금)'이 부족하거나, 설정된 `min_order_amount`(최소 주문 금액)보다 적으면 매수하지 않습니다.
4.  **보유 종목 수 제한**: `config/settings.py`의 `max_positions` 설정값만큼 이미 종목을 보유 중이라면 신규 매수를 하지 않습니다.
5.  **API 권한 문제**: API 키를 만들 때 '주문(매수/매도)' 권한을 체크하지 않았거나, IP 주소 제한이 걸려있으면 주문이 실패합니다.

### Q. 수익률이 마이너스인데 손절을 안 해요.
*   **전략적 판단**: 봇은 단순 하락이 아니라 '추세가 꺾였다'고 판단할 때 매도합니다.
*   **설정 확인**: `config/settings.py`의 `stop_loss_percent`(손절률) 설정을 확인하세요. 0으로 되어있으면 ATR(변동성) 기반으로 유동적으로 작동합니다.

### Q. 텔레그램 알림이 안 와요.
*   `.env` 파일에 `TELEGRAM_BOT_TOKEN`과 `TELEGRAM_CHAT_ID`가 정확히 입력되었는지 확인하세요.
*   봇을 처음 만들었다면 봇에게 먼저 말을 걸어야(Start 버튼) 알림을 받을 수 있습니다.

---

## 6. 설정 값 튜닝 가이드 (Configuration Tuning)

`config/settings.py` 파일에서 봇의 성격을 결정하는 주요 설정값들에 대한 설명과 권장 범위입니다.

### 💰 자금 관리 (Money Management)
*   **`initial_capital`**: 봇이 운용할 초기 자본금입니다. 실제 계좌 잔고보다 적게 설정하여 리스크를 제한할 수 있습니다.
*   **`max_position_size`** (권장: `0.1` ~ `0.3`): 한 종목에 투자할 최대 비중입니다.
    *   `0.1` (10%): 보수적. 분산 투자 효과가 큽니다. (최대 10종목 보유 가능)
    *   `0.3` (30%): 공격적. 소수 종목에 집중하여 수익 극대화. (최대 3종목 보유 가능)

### 📈 매매 전략 (Strategy)
*   **`take_profit_percent`** (익절 목표):
    *   **스캘핑(1분봉)**: `0.01` ~ `0.03` (1% ~ 3%). 짧은 파동을 취합니다.
    *   **단기/스윙(15분봉)**: `0.05` ~ `0.10` (5% ~ 10%). 추세를 어느 정도 따라갑니다.
    *   **추세 추종**: `0.15` 이상. 트레일링 스탑과 함께 사용하여 큰 추세를 먹습니다.
*   **`stop_loss_percent`** (손절 제한):
    *   `0`: **ATR 기반 동적 손절** 사용 (권장). 시장 변동성에 맞춰 손절폭이 자동으로 조절됩니다.
    *   `0.02` ~ `0.05`: 고정 손절 사용 시. (2% ~ 5%)
*   **`k_value`** (변동성 돌파 계수):
    *   권장 범위: `0.4` ~ `0.7`
    *   낮을수록(`0.4`): 진입이 빠르지만, 거짓 신호(Whipsaw)에 걸릴 확률이 높습니다.
    *   높을수록(`0.7`): 진입이 늦지만, 확실한 추세에서만 매매합니다.